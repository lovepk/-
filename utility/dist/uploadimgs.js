define(function(b,a,c){b("../webuploader.js");var e={$showImglist:"#imglist",$uploaded:"#uploaded"};function d(f){this.opt=$.extend({},e,f);this.init();}d.prototype={init:function(){var f=this;this.elShowList=$(f.opt.$showImglist);this.elUped=$(f.opt.$uploaded);this.elUpbtn=$(f.opt.$upbtn);this.memoryImgs=$(f.opt.$memoryImgs);this.thumbnailWidth=this.elShowList.width()/3;this.bind();this.css();this.initImgList();},initImgList:function(){var g=this;var h=this.memoryImgs.val(),f=JSON.parse(h);if(f.length==0){console.log("no info!");return;}$.each(f,function(i,j){var k=$(['<div id="imgId'+i+'" class="img-item thumbnail">','<img src=">'+j.imgurl+'" />',"</div>"].join(""));g.elShowList.append(k);});},bind:function(){var f=this;f.elUpbtn.click(function(g){f.uploader.upload();});f.uploader=WebUploader.create({server:f.opt.server,pick:f.opt.$selbtn,fileSingleSizeLimit:512*1024,fileNumLimit:3,accept:f.opt.accept});f.uploader.on("fileQueued",function(h){console.log(h);var i=$('<div id="imgId'+h.id+'" class="img-item thumbnail"><img><a href="javascript:;" id="del'+h.id+'"></a></div>'),g=i.find("img");i.self.elShowList.on("click","#del"+h.id,function(){console.log("del");$("#imgId"+h.id).remove();f.uploader.removeFile(h);});f.uploader.makeThumb(h,function(j,k){if(j){g.replaceWith("<span>不能预览</span>");return;}g.attr("src",k);},f.thumbnailWidth,200);});f.uploader.on("fileDequeued",function(){console.log($(".img-item").length);});f.uploader.on("uploadSuccess",function(i,h){console.log(i);var j=this.memoryImgs.val()||[],g=JSON.parse(j);f.opt.addCallback(i,h);});f.uploader.on("uploadError",function(g){console.log(g);});},css:function(){var f='@charset "utf-8";.webuploader-element-invisible{clip:rect(1px,1px,1px,1px);position:absolute !important;}';var h=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(h);if(h.styleSheet){if(!h.styleSheet.disabled){h.styleSheet.cssText=f;}}else{try{h.innerHTML=f;}catch(g){h.innerText=f;}}}};return function(f){new d(f);};});